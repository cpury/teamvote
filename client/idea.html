<template name="listIdeas">
  {{#if Template.subscriptionsReady}}
    {{> projectHeading}}
    {{> toolbar}}

    {{#if ideas.count}}
      <div class="panel-group idea-list" id="accordion">
        {{#with ideas}}
          {{#each ideas}}
            {{> idea}}
          {{/each}}
        {{/with}}
      </div>
    {{else}}
      {{> noIdeas}}
    {{/if}}

    {{#if currentUser}}
      {{> onlineUserList}}
      {{> editIdeaModal}}
    {{/if}}
  {{else}}
    <br />
    <h1 class="text-center">
      Loading the app...<br />
      <small>Just a second :)</small>
    </h1>
    {{> spinner}}
  {{/if}}
</template>

<template name="projectHeading">
  <div id="projectHeading" class="text-center panel panel-primary lead">
    <div class="panel-heading">
      <small><em>Max asks:</em></small><br />
      <h1 style="margin: 0">How can TeamVote be improved?</h1>
    </div>
  </div>
</template>

<template name="noIdeas">
  <div class="text-center">
    <br />
    <br />
    <h1>No ideas yet!</h1>
    {{#if currentUser}}
      <h4>Share your ideas to start brainstorming!</h4>
    {{else}}
      <h4>Log in to start brainstorming!</h4>
    {{/if}}
    <br />
    <br />
  </div>
</template>

<template name="idea">
  <div id="panel-{{_id}}" class="panel panel-default">
    <div class="panel-heading">
      {{>ideaHeading}}
    </div>

    <div id="collapse-{{_id}}" class="panel-collapse collapse">
      {{>ideaContent}}
    </div>
  </div>
</template>

<template name="ideaHeading">
  <table class="idea-heading-table">
    <tr>
      <td class="idea-heading-button-td text-center">
        {{#if currentUser}}
          <button type="button" class="btn btn-{{#if ideaIsUpvoted this}}success{{else}}default{{/if}} upvote-idea">
            <i class="glyphicon glyphicon-circle-arrow-up"></i>
            {{upvoteCount}}
          </button>
        {{else}}
          <a tabindex="0" role="button" class="btn btn-{{#if ideaIsUpvoted this}}success{{else}}default{{/if}} upvote-idea" data-toggle="popover" data-trigger="focus" title="Please log in" data-content="You need a user account to vote on ideas.">
            <i class="glyphicon glyphicon-circle-arrow-up"></i>
            {{upvoteCount}}
          </a>
        {{/if}}
      </td>

      <td class="idea-heading-badges-td text-center hidden-xs">
        {{#if commentCount}}
          <span class="badge" style="padding-left: 5px">
              <i class="glyphicon glyphicon-comment"></i>
              {{commentCount}}
          </span>
        {{/if}}
      </td>

      <td class="idea-heading-title-td">
        <h4 class="panel-title idea-heading">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse-{{_id}}">
            {{title}}
          </a>
        </h4>
      </td>

      {{#if userOwnsIdea this}}
        <td class="idea-heading-toolbar-td">
          {{>ideaToolbar}}
        </td>
      {{/if}}
    </tr>
  </table>
</template>

<template name="ideaToolbar">
  <div class="btn-group pull-right btn-group-xs idea-toolbar">
    <button type="button" class="btn btn-default edit-idea"><i class="glyphicon glyphicon-pencil"></i></button>
    <button type="button" class="btn btn-default delete-idea"><i class="glyphicon glyphicon-trash"></i></button>
  </div>
</template>

<template name="ideaContent">
  <div class="panel-body">
    <div class="row">
      <div class="col-xs-8 col-sm-9 col-md-10">
        <p class="well idea-content-well idea-description">
          {{#if description}}
            {{#autolink}}{{description}}{{/autolink}}
          {{else}}
            <em>(No description given.)</em>
          {{/if}}
        </p>
      </div>
      <div class="col-xs-4 col-sm-3 col-md-2">
        <div class="pull-right idea-content-well alert alert-info">
          <em>Added {{livestamp createdAt}} by <b>{{authorName}}</b></em>
        </div>
      </div>
    </div>
    <div class="comments">
      <ul class="list-group">
        {{> newComment}}
        {{#each comments}}
          {{> comment}}
        {{/each}}
      </ul>
    </div>
  </div>
</template>

<template name="onlineUserList">
  <small class="pull-right text-right">
    <strong><i class="glyphicon glyphicon-user"></i> Online users:</strong>
    <ul class="list-inline">
      {{#each onlineUsers}}
        <li>{{username}}</li>
      {{/each}}
    </ul>
  </small>
</template>

<template name="editIdeaModal">
  <div class="modal fade" id="editIdeaModal" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <form id="edit-idea">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="editIdeaModelLabel">Edit idea</h4>
          </div>
          <div class="modal-body clearfix">
              <div class="form-group">
                <div class="input-group input-group-lg">
                  <span class="input-group-addon"><i class="glyphicon glyphicon-exclamation-sign"></i></span>
                  <input type="text" class="form-control" placeholder="Title" name="title" maxlength="100" id="editIdeaTitle" autocomplete="off" autofocus>
                </div>

                <div class="input-group input-group-lg">
                  <span class="input-group-addon"><i class="glyphicon glyphicon-pencil"></i></span>
                  <input type="text" class="form-control" placeholder="Description (optional)" name="description" maxlength="200" id="editIdeaDescription" autocomplete="off">
                </div>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Apply</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</template>
